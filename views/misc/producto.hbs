<h1>producto</h1>
<p>tienda id {{prod.tienda}}</p>
<p>name : {{prod.name}}</p>
<p>Descripcion :{{prod.description}} </p>
<p>Precio : {{prod.precio}} €</p>

<img style="max-width:20%;" src="{{prod.image1}}" alt="">
<img style="max-width:20%;" src="{{prod.image2}}" alt="">

{{#ifIsDueño dueñoId=currentUser.id tiendaOwnerId=prod.ownerId}}
<div>
    <a href="/producto/{{prod.id}}/edit/{{prod.tienda}}" class="btn btn-success mt-1"> edit </a>               
</div>

<form method="POST" action="/producto/{{prod.id}}/delete/{{prod.tienda}}">
    <button type="submit">Delete</button>
</form>   
{{/ifIsDueño}}



 {{!-- --------------------------  COMMENT AND STARS --------------------------  --}}

{{#if currentUser}}  
    {{!-- Display Average Rating stars --}}
    <b>Rating: <span id="averageStars"></span></b>
    <p id="avRatingToIndexJs" hidden>{{averageRating}}</p>
    

    {{!-- add comment - button--}}
    {{#ifNoCommentOfCurrenUser currentUser=currentUser.id allInfo = prod.comments}}
    <a href="#"  data-bs-toggle="modal" data-bs-target="#commentModal">
        comment
    </a>
    {{/ifNoCommentOfCurrenUser}}

    {{!-- add comment - modal--}}
    <div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">

        <div class="modal-header">
            <h5 class="modal-title" id="commentModalLabel">Add comment</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
            <form action="/comment/{{prod.id}}/{{currentUser.id}}" method="POST" >
                <textarea name="comment" class="form-control"  required></textarea>

                {{!--    --}}
                <div class="rating" >
                    <input type="radio" name="rating" value="5" id="5" required><label for="5">☆</label> 
                    <input type="radio" name="rating" value="4" id="4"><label for="4">☆</label> 
                    <input type="radio" name="rating" value="3" id="3"><label for="3">☆</label> 
                    <input type="radio" name="rating" value="2" id="2"><label for="2">☆</label> 
                    <input type="radio" name="rating" value="1" id="1"><label for="1">☆</label>
                </div>

                <button type="submit" class="btn btn-primary">Post Comment</button>
            </form>
        </div>
    </div>
    </div>
    </div>
        

    {{!--  COMMENTS SECTION--}}
    <div>
        {{#each prod.comments as | comm |}}
        <div class="border col-4 ">

            {{!-- display user image,name,rating,comment --}}
            <div>
                <img src="{{comm.user.image}}" alt="" class="logoCircle">
                <p style="display: inline;">User : {{comm.user.name}}</p>
                <p class="userRatingToIndexJs" >{{comm.rating}}</p>
                <p class="text-break" >Comment :{{comm.comment}}</p>
            </div>
                        
            {{!-- EDIT - DELETE COMMENT --}}
            {{#ifCommentOfTheCurrentUser idUserWhoCommented=comm.user.id  currentUserId=../currentUser.id}}
            <div>
                
                {{!-- edit comment button--}}
                <a href="#" data-bs-toggle="modal" data-bs-target="#editCommentModal">
                    edit comment
                </a>

                {{!-- edit comment  modal--}}
                <div class="modal fade" id="editCommentModal" tabindex="-1" aria-labelledby="editCommentModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="editCommentModalLabel">Edit comment</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <form action="/comment/edit/{{comm.id}}/{{../prod.id}}/{{comm.user.id}}" method="POST">            
                            <textarea name="comment" class="form-control" id="message-text" required>{{comm.comment}}</textarea>

                            <div class="rating" >
                                {{comm.rating}}
                                <p id="valor" hidden >{{comm.rating}}</p>
                                {{#checked value=comm.rating}}
                                {{/checked}}
                                <input type="radio" name="rating" edit-value="5" value="5" id="10" required><label for="10">☆</label> 
                                <input type="radio" name="rating" edit-value="4" value="4" id="9"><label for="9">☆</label> 
                                <input type="radio" name="rating" edit-value="3" value="3" id="8"><label for="8">☆</label> 
                                <input type="radio" name="rating" edit-value="2" value="2" id="7"><label for="7">☆</label> 
                                <input type="radio" name="rating" edit-value="1" value="1" id="6"><label for="6">☆</label>
                                
                            </div>
                      

                            <button type="submit" class="btn btn-primary">Post Comment</button>
                        </form>
                    </div>
                </div>
                </div>
                </div>

                {{!-- delete comment button--}}
                <a href="#" data-bs-toggle="modal" data-bs-target="#deleteCommentModal">
                    Delete comment
                </a>

                {{!-- delete comment  modal--}}
                <div class="modal fade" id="deleteCommentModal" tabindex="-1" aria-labelledby="deleteCommentModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteCommentModalLabel">Delete comment</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        Are you sure?
                    </div>

                    <div class="modal-footer">

                    <form method="POST" action="/comment/delete/{{comm.id}}/{{../prod.id}}/{{comm.user.id}}">
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </form> 
                </div>
                </div>
                </div>
                </div>


            </div>
            {{/ifCommentOfTheCurrentUser}}
        </div>
            
        {{/each}}
    </div>

{{/if}}
            
           
<script>
    // when edit comment, show the stars checked
    let val = document.getElementById("valor")
    if(val) {
    let selectItem = val.innerText
    document.querySelector(`[edit-value="${selectItem}"]`).checked = true
    }
</script>